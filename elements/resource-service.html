<!--
Element which is meant to be extended by the service elements. It provides the
ajax functionality and other common actions between resources.

@element resource-service
@blurb Element which is meant to be extended by the service elements. It
  provides the ajax functionality and other common actions between resources.
@status alpha
-->

<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../core-ajax/core-ajax.html">

<polymer-element name="resource-service" attributes="resource baseUrl authToken">

  <template>

    <style>
      :host {
        display: none;
      }
    </style>

    <core-ajax
      id="ajax"
      method="{{method}}"
      url="{{baseUrl}}{{resource}}{{resourceUid}}"
      params="{{params}}"
      headers='{"Authorization": "Basic {{authToken}}"}'
      contentType="application/json"
      handleAs="json"
      on-core-response="{{onResponse}}"></core-ajax>

  </template>

  <script>

    Polymer('resource-service', {

      /**
       * Fired when the requested resource(s) has been loaded from the API.
       *
       * Examples:
       *   events-loaded
       *   products-loaded
       *
       * @event <resource>-loaded
       */

      eventsMethodsMap: {
        'GET': '-loaded',
        'POST': '-created'
      },

      onResponse: function(event) {
        var response = event.detail.response;
        if (response.length === undefined) {
          response = [response];
        }
        var eventName = this.resource + this.eventsMethodsMap[this.method];
        this.fire(eventName, response);
      },

      get: function(resourceUid) {
        this.method = "GET";
        if (resourceUid !== undefined) {
          this.resourceUid = "/" + resourceUid;
        }
        this.$.ajax.go();
      },

      filter: function(params) {
        this.method = "GET";
        this.params = params;
        this.$.ajax.go();
      }

    });

  </script>

</polymer-element>

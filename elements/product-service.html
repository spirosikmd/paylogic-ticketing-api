<!--
Element which encapsulates the functionality for the Product resource of the Paylogic Ticketing API.

##### Example

    <product-service
      authToken="{{authToken}}"
      baseUrl="{{baseUrl}}"
      on-products-loaded="{{handleProductsLoaded}}"></product-service>

@element product-service
@blurb Element which encapsulates the functionality for the Product resource of the Paylogic Ticketing API.
@status alpha
-->

<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../core-ajax/core-ajax.html">

<polymer-element name="product-service" attributes="baseUrl authToken">

  <template>

    <core-ajax
      id="ajax"
      method="{{method}}"
      url="{{baseUrl}}products{{productUid}}"
      params="{{params}}"
      headers='{"Authorization": "Basic {{authToken}}"}'
      handleAs="json"
      on-core-response="{{handleGet}}"></core-ajax>

  </template>

  <script>

    Polymer('product-service', {

      /**
       * Fired when the products have been loaded from the API.
       *
       * @event products-loaded
       */

      handleGet: function(event) {
        response = event.detail.response;
        if (response.length === undefined) {
          response = [response];
        }
        this.fire('products-loaded', response);
      },

      get: function(productUid) {
        this.method = "GET";
        this.productUid = "/" + productUid;
        this.$.ajax.go();
      },

      filter: function(params) {
        this.method = "GET";
        this.params['event'] = this.baseUrl + 'events/' + params['event'];
        this.$.ajax.go();
      }

    });

  </script>

</polymer-element>

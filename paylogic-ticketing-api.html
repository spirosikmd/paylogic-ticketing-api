<!--
Element which encapsulates the functionality provided by the Paylogic Ticketing API.

##### Example

    <paylogic-ticketing-api></paylogic-ticketing-api>

@element paylogic-ticketing-api
@blurb Element which encapsulates the functionality provided by the Paylogic Ticketing API.
@status alpha
@homepage https://github.com/spirosikmd/paylogic-ticketing-api
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-ajax/core-ajax.html">
<link rel="import" href="elements/event-service.html">
<link rel="import" href="elements/product-service.html">

<polymer-element name="paylogic-ticketing-api" attributes="events products">

  <template>

    <link rel="stylesheet" href="paylogic-ticketing-api.css" />

    <core-ajax
      auto
      url="private/data.json"
      handleAs="json"
      on-core-response="{{initPrivates}}"></core-ajax>

    <event-service
      id="eventService"
      authToken="{{authToken}}"
      baseUrl="{{baseUrl}}"
      on-events-loaded="{{handleEventsLoaded}}"></event-service>

    <product-service
      id="productService"
      authToken="{{authToken}}"
      baseUrl="{{baseUrl}}"
      on-products-loaded="{{handleProductsLoaded}}"></product-service>

    <content></content>

  </template>

  <script>

    Polymer('paylogic-ticketing-api', {

      /**
       * Fired when initialization of privates is completed.
       *
       * @event init-ready
       */

      /**
       * Fired when the event list has been loaded by the Event resource service.
       *
       * @event pta-events-loaded
       */

       /**
       * Fired when the product list has been loaded by the Product resource service.
       *
       * @event pta-products-loaded
       */

      /**
       * The Event resource service.
       *
       * @attribute events
       * @type event-service
       * @default null
       */
      events: null,

      /**
       * The Product resource service.
       *
       * @attribute products
       * @type product-service
       * @default null
       */
      products: null,

      ready: function() {
        this.events = this.$.eventService;
        this.products = this.$.productService;
      },

      initPrivates: function(event) {
        this.appId = event.detail.response.appId;
        this.appSecret = event.detail.response.appSecret;
        this.authToken = btoa(this.appId + ':' + this.appSecret);
        this.baseUrl = event.detail.response.baseUrl;
        this.fire('init-ready');
      },

      handleEventsLoaded: function(event) {
        this.fire('pta-events-loaded', event.detail);
      },

      handleProductsLoaded: function(event) {
        this.fire('pta-products-loaded', event.detail);
      }

    });

  </script>

</polymer-element>

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-ajax/core-ajax.html">

<!--
Element which encapsulates the functionality provided by the Paylogic Ticketing API.

##### Example

    <paylogic-ticketing-api></paylogic-ticketing-api>

@element paylogic-ticketing-api
@blurb Element which encapsulates the functionality provided by the Paylogic Ticketing API.
@status alpha
@homepage https://github.com/spirosikmd/paylogic-ticketing-api
-->
<polymer-element name="paylogic-ticketing-api" attributes="notitle">

  <template>

    <link rel="stylesheet" href="paylogic-ticketing-api.css" />

    <core-ajax
      auto
      url="private/data.json"
      handleAs="json"
      on-core-response="{{initPrivates}}"></core-ajax>

    <core-ajax
      id="eventService"
      url="{{baseUrl}}/events/32441a11f9024cd9bf1acdc5c3def80a"
      headers='{"Authorization": "Basic {{authToken}}"}'
      handleAs="json"
      on-core-response="{{handleEventGet}}"></core-ajax>

    <content>
      <div>{{event.title.en}}</div>
      <div>{{event.subtitle.en}}</div>
    </content>

  </template>

  <script>

    Polymer('paylogic-ticketing-api', {
      /**
       * The `noevent` event is not actually fired from here,
       * we document it as an example of documenting events.
       *
       * @event noevent
       */

      /**
       * The `notitle` attribute does not yet have a purpose.
       *
       * @attribute notitle
       * @type string
       */
      notitle: '',

      /**
       * The `aProp` is a property that does something cool.
       *
       * @property aProp
       * @type bool
       */
      aProp: false,

      ready: function() {
      },

      /**
       * The `initPrivates` method initializes settings.
       *
       * @method initPrivates
       * @param {CustomEvent} event which fired.
       * @param {Object} data contains the private json data and the XMLHttpRequest object.
       * @param {HTMLElement} element which fired the event.
       */
      initPrivates: function(event, data, element) {
        this.appId = data.response.appId;
        this.appSecret = data.response.appSecret;
        this.authToken = btoa(this.appId + ':' + this.appSecret);
        this.baseUrl = data.response.baseUrl;

        this.$.eventService.go();
      },

      /**
       * The `handleEventGet` method handles the success event to GET /events/<event_uid>.
       *
       * @method handleEventGet
       * @param {CustomEvent} event which fired.
       * @param {Object} data contains the event object data and the XMLHttpRequest object.
       * @param {HTMLElement} element which fired the event.
       */
      handleEventGet: function(event, data, element) {
        this.event = data.response;
      }

    });

  </script>

</polymer-element>

<!--
Element which encapsulates the functionality provided by the Paylogic Ticketing API.

##### Example

    <paylogic-ticketing-api></paylogic-ticketing-api>

@element paylogic-ticketing-api
@blurb Element which encapsulates the functionality provided by the Paylogic Ticketing API.
@status alpha
@homepage https://github.com/spirosikmd/paylogic-ticketing-api
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-ajax/core-ajax.html">
<link rel="import" href="elements/event-service.html">
<link rel="import" href="elements/product-service.html">
<link rel="import" href="elements/location-service.html">
<link rel="import" href="elements/merchant-service.html">
<link rel="import" href="elements/profile-service.html">
<link rel="import" href="elements/basket-service.html">

<polymer-element name="paylogic-ticketing-api">

  <template>

    <link rel="stylesheet" href="paylogic-ticketing-api.css" />

    <core-ajax
      auto
      url="private/data.json"
      handleAs="json"
      on-core-response="{{initPrivates}}"></core-ajax>

    <event-service
      id="events-service"
      authToken="{{authToken}}"
      baseUrl="{{baseUrl}}"></event-service>

    <product-service
      id="products-service"
      authToken="{{authToken}}"
      baseUrl="{{baseUrl}}"></product-service>

    <location-service
      id="locations-service"
      authToken="{{authToken}}"
      baseUrl="{{baseUrl}}"></location-service>

    <merchant-service
      id="merchants-service"
      authToken="{{authToken}}"
      baseUrl="{{baseUrl}}"></merchant-service>

    <profile-service
      id="profiles-service"
      authToken="{{authToken}}"
      baseUrl="{{baseUrl}}"></profile-service>

    <basket-service
      id="baskets-service"
      authToken="{{authToken}}"
      baseUrl="{{baseUrl}}"></basket-service>

    <content></content>

  </template>

  <script>

    Polymer('paylogic-ticketing-api', {

      /**
       * Fired when initialization of privates is completed.
       *
       * @event init-ready
       */

      ready: function() {
        for (nodeId in this.$) {
          var split = nodeId.split('-');
          var service = split[0];
          var identifier = split[1];
          if (identifier === 'service') {
            this[service] = this.$[nodeId];
          }
        }
      },

      initPrivates: function(event) {
        this.appId = event.detail.response.appId;
        this.appSecret = event.detail.response.appSecret;
        this.authToken = btoa(this.appId + ':' + this.appSecret);
        this.baseUrl = event.detail.response.baseUrl;
        this.fire('init-ready');
      }

    });

  </script>

</polymer-element>
